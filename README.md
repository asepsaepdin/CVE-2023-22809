# Exploit for CVE-2021-3560 (Sudoedit a.k.a -e) - Local Privilege Escalation
*For educational and authorized security research purposes only.*

## Original Exploit Authors
[n3m1dotsys](https://github.com/n3m1dotsys)

## Vulnerability Description
In Sudo before 1.9.12p2, the sudoedit (aka -e) feature mishandles extra arguments passed in the user-provided environment variables (SUDO_EDITOR, VISUAL, and EDITOR), allowing a local attacker to append arbitrary entries to the list of files to process. This can lead to privilege escalation. Affected versions are 1.8.0 through 1.9.12.p1. The problem exists because a user-specified editor may contain a "--" argument that defeats a protection mechanism, e.g., an EDITOR='nano -- /path/to/extra/file' value.

## Exploit Description
This script automates the exploitation of the CVE-2023-22809 vulnerability to gain a root shell.
The script checks if the current user has access to run the ```sudoedit``` or ```sudo -e``` command for some file with root privileges. If it does it opens the sudoers file for the attacker to introduce the privilege escalation policy for the current user and get a root shell.

## Usage
```bash
  ./exploit.sh
```

## Download Via Original Source
[Download Exploit Script for CVE-2023-22809 Here](https://github.com/n3m1dotsys/CVE-2023-22809-sudoedit-privesc/blob/main/exploit.sh)

## Exploit Requirements
- nano
- sudo

## Demo
[Screenshot 2023-07-10 135107](https://github.com/asepsaepdin/CVE-2023-22809/assets/122620685/c237b0b2-b70f-4b27-a5bc-1b3e11ba3c72)

## Tested On
- Polkit Version 0.105-26 (Ubuntu 20.04.1 LTS)
- Polkit Version 0.105 (Ubuntu 20.04.2 LTS)

## Applies To
Polkit Versions 0.0 - 0.118

## Test Environment
```bash
apt install nano sudo
```

## Warning
⚠️ Running this exploit on a system can be done in two ways: using the nano editor and the vim editor

## Credits
- https://packetstormsecurity.com/files/171644/sudo-1.9.12p1-Privilege-Escalation.html
- https://github.com/n3m1dotsys/CVE-2023-22809-sudoedit-privesc
- https://medium.com/@dev.nest/how-to-bypass-sudo-exploit-cve-2023-22809-vulnerability-296ef10a1466
- https://github.com/hello4r1end/patch_CVE-2023-22809
